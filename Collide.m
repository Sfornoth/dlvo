W = [1./3., 1./18., 1./18., 1./18., 1./18., 1./18., 1./18., 1./36., 1./36., 1./36., 1./36., 1./36., 1./36., 1./36., 1./36., 1./36., 1./36., 1./36., 1./36.];
C = {
	{ 0, 0, 0},... 
    { 1, 0, 0}, {-1, 0, 0}, { 0, 1, 0}, { 0,-1, 0}, { 0, 0, 1}, { 0, 0,-1},... 
    { 1, 1, 0}, {-1,-1, 0}, { 1,-1, 0}, {-1, 1, 0}, { 1, 0, 1}, {-1, 0,-1},...
    { 1, 0,-1}, {-1, 0, 1}, { 0, 1, 1}, { 0,-1,-1}, { 0, 1,-1}, { 0,-1, 1}};
M = [1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
-30 -11 -11 -11 -11 -11 -11 8 8 8 8 8 8 8 8 8 8 8 8
12 -4 -4 -4 -4 -4 -4 1 1 1 1 1 1 1 1 1 1 1 1
0 1 -1 0 0 0 0 1 -1 1 -1 1 -1 1 -1 0 0 0 0
0 -4 4 0 0 0 0 1 -1 1 -1 1 -1 1 -1 0 0 0 0
0 0 0 1 -1 0 0 1 1 -1 -1 0 0 0 0 1 -1 1 -1
0 0 0 -4 4 0 0 1 1 -1 -1 0 0 0 0 1 -1 1 -1
0 0 0 0 0 1 -1 0 0 0 0 1 1 -1 -1 1 1 -1 -1
0 0 0 0 0 -4 4 0 0 0 0 1 1 -1 -1 1 1 -1 -1
0 2 2 -1 -1 -1 -1 1 1 1 1 1 1 1 1 -2 -2 -2 -2
0 -4 -4 2 2 2 2 1 1 1 1 1 1 1 1 -2 -2 -2 -2
0 0 0 1 1 -1 -1 1 1 1 1 -1 -1 -1 -1 0 0 0 0
0 0 0 -2 -2 2 2 1 1 1 1 -1 -1 -1 -1 0 0 0 0
0 0 0 0 0 0 0 1 -1 -1 1 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 -1 -1 1
0 0 0 0 0 0 0 0 0 0 0 1 -1 -1 1 0 0 0 0
0 0 0 0 0 0 0 1 -1 1 -1 -1 1 -1 1 0 0 0 0
0 0 0 0 0 0 0 -1 -1 1 1 0 0 0 0 1 -1 1 -1
0 0 0 0 0 0 0 0 0 0 0 1 1 -1 -1 -1 -1 1 1];
vel = [0 0 0];
rho = 1.0;
for k = 1:19
    c = [C{k}{1},C{k}{2},C{k}{3}];
    VdotV = sum(vel.*vel);   
    VdotC = sum(vel.*c);
    Feq(k,1) = W(k)*rho*(1.0 + 3.0*VdotC + 4.5*VdotC*VdotC - 1.5*VdotV);
end
m = M*Feq;
meq(1) = rho;
meq(2) = -11*rho+19*rho^2*sum(vel.*vel);
meq(3) = 3*rho - 11/2*rho^2*sum(vel.*vel);
meq(4) = rho*vel(1);
meq(5) = -2/3*rho*vel(1);
meq(6) = rho*vel(2);
meq(7) = -2/3*rho*vel(2);
meq(8) = rho*vel(3);
meq(9) = -2/3*rho*vel(3);
meq(10) = 2*rho^2*vel(1)^2 - rho^2*vel(2)^2-rho^2*vel(3)^2;
meq(11) = -0.5*meq(10);
meq(12) = rho^2*vel(2)^2-rho^2*vel(3)^2;
meq(13) = -0.5*meq(12);
meq(14) = rho^2*vel(1)*vel(2);
meq(15) = rho^2*vel(2)*vel(3);
meq(16) = rho^2*vel(1)*vel(3);
meq(17) = 0;
meq(18) = 0;
meq(19) = 0;
Tau = 0.53;
s9 = 1/Tau;
s13 = s9;
s1 = 8.0*(2.0-s9)/(8.0-s9);
s2 = s1;
s4 = s1;
s10 = s1;
s16 = s1;
S = [0, s1, s2, 0, s4, 0, s4, 0, s4, s9, s10, s9, s10, s13, s13, s13, s16, s16, s16];

for k=1:19;
    
    mt(k,1) = S(k)*(m(k)-meq(k));
end
ft = Feq + M^-1*mt;

Minv = M^-1;
% fid = fopen('D3Q19_Minv_Code.txt','w');
% for i=1:19
%     fprintf(fid,'{')
%     for j = 1:19
%         fprintf(fid,' %f,',Minv(i,j));
%     end
%     fprintf(fid,'},\n');
% end
% fclose(fid)